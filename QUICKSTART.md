# Quick Start Guide - M3 Mac Setup

This guide will get your Google Drive backup system running on your M3 Mac in under 5 minutes.

## What You Need

- **Homebrew** installed
- **15 minutes** of your time

## Step 1: Install Prerequisites

```bash
# Install Multipass (lightweight VM manager for ARM Macs)
brew install multipass

# Install Ansible
brew install ansible
```

## Step 2: Run the Automated Setup Script

This script will:
- Create an Ubuntu VM
- Set up SSH access
- Create a test database
- Generate dummy credentials (since you don't have real ones yet)

```bash
cd gdrive_backup_test
./setup_m3.sh
```

Wait for it to complete (2-3 minutes). You'll see green checkmarks as each step completes.

## Step 3: Run the Ansible Playbook

This will configure everything in the VM:

```bash
ansible-playbook -i inventory.ini playbook.yml
```

Expected output:
- âœ… Packages installed (sqlite3, rclone)
- âœ… Config files deployed
- âœ… Backup script created
- âœ… Cron job scheduled
- âš ï¸  Warning about rclone connection (expected without real credentials)

## Step 4: Test the Backup Script

```bash
# SSH into the VM
multipass shell sandbox

# Run the backup script manually
sudo /usr/local/bin/backup_sqlite.sh
```

**Expected behavior:** 
- âœ… Database backup will be created in `/tmp/sqlite_backups/`
- âŒ Upload to Google Drive will fail (expected - you don't have real credentials yet)

The script will show an error about authentication, which is normal at this stage.

## Step 5: Verify Everything Is Set Up

Check that all the pieces are in place:

```bash
# Still inside the VM (multipass shell sandbox)

# Check the backup script exists
ls -l /usr/local/bin/backup_sqlite.sh

# Check the test database exists
sudo ls -l /var/lib/myapp/db.sqlite

# Check rclone config exists
sudo ls -l /etc/rclone/

# Check cron job is scheduled
sudo crontab -l

# Exit the VM
exit
```

## What You've Accomplished

ğŸ‰ **Congratulations!** You now have:

1. âœ… A working Ubuntu VM on your M3 Mac
2. âœ… Ansible configured and tested
3. âœ… A test SQLite database
4. âœ… Backup script installed and ready
5. âœ… Automated daily backups scheduled (will work once you add real credentials)

## Next Steps: When You Get Google Drive Credentials

### 1. Get Service Account Credentials

Follow Google Cloud documentation to:
- Create a project
- Enable Google Drive API
- Create a service account
- Download the JSON key file

### 2. Replace Dummy Credentials

```bash
# On your Mac, in the gdrive_backup_test directory
cp ~/Downloads/your-real-credentials.json files/credentials.json
```

### 3. Share Drive Folder with Service Account

1. Open `files/credentials.json`
2. Find the `client_email` field (looks like: `something@project.iam.gserviceaccount.com`)
3. Go to Google Drive in your browser
4. Create a folder called `sqlite_backups` (or use existing)
5. Right-click â†’ Share â†’ Paste the email address from step 2
6. Give it **Editor** access

### 4. Re-run the Playbook

```bash
ansible-playbook -i inventory.ini playbook.yml
```

### 5. Test with Real Credentials

```bash
multipass shell sandbox
sudo /usr/local/bin/backup_sqlite.sh
```

This time it should work! Check your Google Drive folder for the backup file.

## Useful Commands

```bash
# VM Management
multipass list                    # List all VMs
multipass shell sandbox           # SSH into the VM
multipass stop sandbox            # Stop the VM
multipass start sandbox           # Start the VM
multipass info sandbox            # View VM details (IP, resources, etc.)

# Test Ansible connection
ansible -i inventory.ini sandbox -m ping

# View backup logs (from inside VM)
multipass shell sandbox
tail -f /var/log/db_backup.log
```

## Troubleshooting

### "Can't connect to VM"
```bash
multipass restart sandbox
sleep 10
ansible -i inventory.ini sandbox -m ping
```

### "Update IP address in inventory"
```bash
# Get new IP
multipass info sandbox | grep IPv4

# Then edit inventory.ini and replace the IP address
```

### "Start fresh"
```bash
multipass delete sandbox
multipass purge
./setup_m3.sh
```

## File Structure

```
gdrive_backup_test/
â”œâ”€â”€ setup_m3.sh              # Automated setup script (run this first!)
â”œâ”€â”€ inventory.ini            # Ansible inventory (auto-generated by setup script)
â”œâ”€â”€ playbook.yml             # Ansible playbook (main configuration)
â”œâ”€â”€ files/
â”‚   â””â”€â”€ credentials.json     # Google service account credentials
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ backup_script.sh.j2  # Backup script template
â”‚   â””â”€â”€ rclone.conf.j2       # Rclone configuration template
â””â”€â”€ SETUP_M3_MAC.md          # Detailed setup documentation
```

## Need More Details?

See `SETUP_M3_MAC.md` for:
- Detailed explanations of each step
- Advanced troubleshooting
- Manual setup instructions
- Understanding how everything works

## Support

If you run into issues:
1. Check `SETUP_M3_MAC.md` for detailed troubleshooting
2. Run `multipass info sandbox` to verify VM status
3. Check logs: `multipass shell sandbox` then `sudo tail /var/log/db_backup.log`

---

**You're all set!** The system will automatically back up your database daily at 2:30 AM once you add real Google Drive credentials.